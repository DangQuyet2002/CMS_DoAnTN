@using Models;
@{

    var LienKetGioiThieu = ViewBag.LienKetGioiThieu as List<tbl_LienKetGioiThieuModel>;
    var CacCapHoi = ViewBag.CacCapHoi as List<tbl_CacCapHoiModel>;
    var BannerTrangChuVT1 = ViewBag.BannerTrangChuVT1 as List<tbl_BannerModel>;
    var BannerTrangChuVT2 = ViewBag.BannerTrangChuVT2 as List<tbl_BannerModel>;
    var DanhSachChuyenMucBenPhaiCT = ViewBag.DanhSachChuyenMucBenPhaiCT as List<tbl_SettingMenu_CategoryModel>;
    //var ChiTietBaiViet = ViewBag.ChiTietBaiViet as tbl_PostModel;
    var ChiTietDM = ViewBag.ChiTietDM as tbl_CategoryModel;
    var TinTucMoi = ViewBag.TinTucMoi as List<tbl_PostModel>;
    //var DanhSachBaiVietCungChuyenMuc = ViewBag.DanhSachBaiVietCungChuyenMuc as List<tbl_PostModel>;
    var ThongTinND = ViewBag.ThongTinND as tbl_UserModel;
    ViewBag.ThongTinIDND = ThongTinND != null ? ThongTinND.ID : 0;
    var ResponeLike = ViewBag.ResponeLike;
    var DanhSachChiHoi = ViewBag.DanhSachChiHoi as List<tbl_ChiHoiTTModel>;
}
<style>

    .border-bottom-new {
        border-bottom: 1px solid;
        border-color: #EBEBEB;
    }

    .avatar-sm-custom {
        height: 5rem;
        width: 5rem;
        object-fit: cover;
        object-position: 0px 0px;
    }

    .card-custom-new {
        margin-bottom: 0px !important
    }

    .front-icon {
        font-size: 20px;
    }

    blockquote {
        margin: 1rem 6rem !important;
    }

    .article blockquote {
        margin: 2.4rem auto 0;
    }

    blockquote div {
        background: white !important;
        border: 0px solid #cccccc !important;
        padding: 0px 0px !important;
    }

    .article blockquote {
        position: relative;
        z-index: 0;
        background: #fff;
        border: 2px solid #ce2e0e;
        box-sizing: border-box;
        padding: 36px 24px;
        margin-top: 30px !important;
    }

        .article blockquote::before {
            content: "";
            position: absolute;
            top: -28px;
            background: #fff url('../../Content/Image/Banner/quote.png') center center no-repeat;
            width: 60px;
            height: 45px;
            left: 15px;
        }
</style>
<link href="~/Content/ControllerCss/HomePage.css" rel="stylesheet" />
<input type="hidden" value="@ViewBag.IdBaiViet" id="IdBaiViet" />
<div class="page-content pb-5">
    <div class="container-fluid pt-3">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between pb-3">
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item active"><a href="#">GIỚI THIỆU</a></li>
                </ol>
            </div>
        </div>


        <div class="row">
            <div id="resultTimKiem" class="col-xl-9 col-lg-12 col-sm-12 SearchTk d-none">
            </div>
            <div class="col-xl-9 col-lg-9 col-sm-12" id="resultTimKiem2">
                <div class="row ">
                    <div class="col-xl-12 col-lg-12 col-sm-12 border-bottom-cm pb-3">
                        <div id="DataDSVanBan">
                            <h2 class="font-w600">Danh sách các Chi hội trực thuộc</h2>
                        </div>
                        <div class="pt-3 singular-content post-detail-content article">

                            <!-- Base Example -->
                            <div class="accordion" id="default-accordion-example">
                                @if (DanhSachChiHoi != null)
                                {
                                    var lstChiHoiCap = DanhSachChiHoi.Where(e => e.ParentId == 0).ToList();
                                    if (lstChiHoiCap.Count > 0)
                                    {
                                        foreach (var item in lstChiHoiCap)
                                        {
                                            <div class="accordion-item">
                                                <h2 class="accordion-header" id="headingOne">
                                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#ChiTiet_@item.Id" aria-expanded="true" aria-controls="ChiTiet_@item.Id">
                                                        @item.Ten
                                                    </button>
                                                </h2>
                                                @{
                                                    var lstChiTieuCon = DanhSachChiHoi.Where(e => e.ParentId == item.Id).ToList();
                                                    if (lstChiTieuCon.Count > 0)
                                                    {
                                                        <div id="ChiTiet_@item.Id" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#default-accordion-example">
                                                            <div class="accordion-body">
                                                                <div class="live-preview">
                                                                    <ol class="list-group list-group-numbered">
                                                                        @foreach (var itemCon in lstChiTieuCon)
                                                                        {
                                                                            <li class="list-group-item"><a href="@itemCon.Url">@itemCon.Ten</a></li>
                                                                        }

                                                                    </ol>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                }

                                            </div>
                                        }
                                    }
                                }

                            </div>

                            @*@Html.Raw(ChiTietBaiViet.PostContent)

                                @if (!string.IsNullOrEmpty(ChiTietBaiViet.TacGia))
                                {
                                    <div class="article__author">
                                        <div class="wrap-author">
                                            <div class="avatar"> </div>
                                            <div class="info-author">
                                                @Html.Raw(ChiTietBaiViet.TacGia)
                                            </div>
                                        </div>
                                    </div>
                                }*@
                        </div>
                    </div>
                </div>

                <div class="card-body p-0 pt-3">
                    @*<a href="http://www.facebook.com/share.php?u=<url>" onclick="return fbs_click()" target="_blank" class="front-icon"><i class=" ri-facebook-circle-fill"></i></a>*@
                    @*<a href="https://twitter.com/intent/tweet?url=
                            @Url.Encode(Request.Url.ToString())&text=@ViewBag.Title"
                           target="_blank" title="Tweet" class="front-icon">
                            <i class="ri-twitter-fill"></i>
                        </a>*@
                    <a href="http://www.facebook.com/share.php?u=<url>" onclick="return fbs_click()" target="_blank" class="sty-facebook">
                        <i class="bx bxl-facebook icon-facebook"></i>
                    </a>

                    <a href="#" class="sty-zalo">
                        <img src="/Content/Image/Banner/zalo-icon-ver2.png" style="font-size: 36px;">
                    </a>
                    <a href="#" target="_blank" class="sty-print" onclick="printSceen()">
                        <i class="bx bx-printer  icon-facebook"></i>
                    </a>
                    @*<span id="TTLikeBaiViet">
                            @if (ResponeLike.Count > 0)
                            {
                                <a href="javascript:void(0)" class="front-icon" onclick="LikeBaiViet(0)"><i class=" bx bxs-like"></i></a>
                            }
                            else
                            {
                                <a href="javascript:void(0)" class="front-icon" onclick="LikeBaiViet(1)"><i class="bx bx-like"></i></a>
                            }
                        </span>*@


                    @*<h4 class="card-title mb-4">Bình luận</h4>

                        <div id="DataBinhLuan">

                        </div>


                        <form action="javascript:void(0);" class="mt-3">
                            <div class="row g-3">
                                <div class="col-lg-12">
                                    <textarea class="form-control bg-light border-light" id="txtBinhLuan" rows="3" placeholder="Nhập bình luận"></textarea>
                                </div>
                                <div class="col-lg-12 text-end">
                                    @if (ViewBag.ThongTinIDND != 0)
                                    {
                                        <a data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-danger" style="font-weight: 700;" id="ThongTinNDBinhLuan">@ThongTinND.UserName</span>
                                        </a>
                                    }
                                    else
                                    {
                                        <a data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="text-danger" style="font-weight: 700;" id="ThongTinNDBinhLuan"></span>
                                        </a>
                                    }

                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="#">Đăng xuất</a>
                                    </div>

                                    <a href="javascript:void(0);" class="btn btn-success" onclick="GuiBinhLuan()">Gửi bình luận</a>
                                </div>
                            </div>
                        </form>*@
                </div>

                @*<div class="row pb-3 pt-3">
                        <div class="col-sm-12 col-xl-12">
                            <h3 class="Color-left-title">Cùng chuyên mục</h3>
                        </div>
                    </div>

                    @if (DanhSachBaiVietCungChuyenMuc.Count > 0)
                    {
                        <div class="row" id="DataDSVideo">
                            @foreach (var itemBV in DanhSachBaiVietCungChuyenMuc)
                            {

                                <div class="col-sm-6 col-xl-3">
                                    @{
                                        var Url = "/" + Utils.convertToUnSign2(itemBV.Title).Replace(" ", "_") + "_bv-" + itemBV.ID + ".htm";
                                        if (!string.IsNullOrEmpty(itemBV.TuKhoaSeo))
                                        {
                                            Url = "/" + Utils.convertToUnSign2(itemBV.TuKhoaSeo).Replace(" ", "_") + "_bv-" + itemBV.ID + ".htm";
                                        }
                                    }
                                    <div class="card card-custom">
                                        <a href="@Url" class="text-black"> <img class="card-img-top img-fluid img-card-video-audio" src="@itemBV.Thumnail" alt="Card image cap"></a>
                                        <div class="card-body  p-0 pt-3">
                                            <h5 class="card-text wraptext-heigth"><a href="@Url" class="text-black">@itemBV.Title</a></h5>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>

                    }*@



                @if (TinTucMoi.Count > 0)
                {
                    <div class="row">
                        <div class="GreenContainerTopMIddleNew pt-3" style="margin-left: 1rem;">
                            <h3 class="Color-left-title">Tin mới</h3>
                        </div>
                        @foreach (var itemTTM in TinTucMoi)
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 p-0 border-bottom-cm">
                                <div class="card-body">
                                    <div class="d-sm-flex">
                                        @{
                                            var Url = "/" + Utils.convertToUnSign2(itemTTM.Title).Replace(" ", "_") + "_bv-" + itemTTM.ID + ".htm";
                                            if (!string.IsNullOrEmpty(itemTTM.TuKhoaSeo))
                                            {
                                                Url = "/" + Utils.convertToUnSign2(itemTTM.TuKhoaSeo).Replace(" ", "_") + "_bv-" + itemTTM.ID + ".htm";
                                            }
                                        }
                                        <div class="flex-shrink-0 width-TTMoi">
                                            <a href="@Url" class="text-black"><img src="@itemTTM.Thumnail" alt="" width="115" class="rounded-1 img-new-duoi-banner "></a>

                                        </div>
                                        <div class="flex-grow-1 ms-sm-4 mt-3 mt-sm-0">
                                            <h4 class="title-new"><a href="@Url" class="text-black">@itemTTM.Title</a></h4>
                                            <p class="text-success fs-12 mb-0">@(itemTTM.NgayPhatHanh!=null?((DateTime)itemTTM.NgayPhatHanh).ToString("dd-MM-yyyy HH:mm") :"")</p>
                                            <a href="@Url" class="text-black"><p class="article-excerpt">@itemTTM.ShortDescription</p></a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }

            </div>
            <div class="col-xl-3 col-lg-4 col-sm-12 hide-right-view-Detail">
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                        <div class="search-box">
                            <input type="text" class="form-control search" placeholder="Tìm kiếm" onchange="TimKiemTrangChu()" id="txtTuKhoa">
                            <i class="ri-search-line search-icon"></i>
                        </div>
                    </div>
                    @if (LienKetGioiThieu.Count > 0)
                    {

                        <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                            <div class="GreenContainerTopMIddleNew">
                                <div class="GreenContainerTitleNew">
                                    <h2>
                                        <span id="dnn_ctr554_Title_titleLabel" class="ContainerTitle"><a href="#" style="color: #ffffff; text-transform: uppercase">Giới thiệu</a></span>
                                    </h2>
                                </div>
                                <div class="stripe-line"></div>
                                <div class="ClearFloat"></div>
                            </div>
                            <div class="Content-Title style-scroll-15" style=" max-height: 350px; overflow: auto;">
                                <ol class="ps-3 text-muted">
                                    @foreach (var item in LienKetGioiThieu)
                                    {
                                        <li class="py-1">
                                            <a href="@item.Url" class="text-muted">@item.MoTa</a>
                                        </li>
                                    }
                                </ol>
                            </div>
                        </div>

                    }

                    @if (CacCapHoi.Count > 0)
                    {

                        <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                            <div class="GreenContainerTopMIddleNew">
                                <div class="GreenContainerTitleNew">
                                    <h2>
                                        <span id="dnn_ctr554_Title_titleLabel" class="ContainerTitle"><a href="#" style="color: #ffffff; text-transform: uppercase">Các cấp hội</a></span>
                                    </h2>
                                </div>
                                <div class="stripe-line"></div>
                                <div class="ClearFloat"></div>
                            </div>
                            <div class="Content-Title style-scroll-15" style=" max-height: 350px; overflow: auto;">
                                @*<input type="text" class="form-control" placeholder="Tìm kiếm..." onchange="TimKKiemCapHoi()" id="txtTuKhoaCapHoi">*@
                                <ol class="ps-3 text-muted" id="DataCapHoi">
                                    @foreach (var item in CacCapHoi)
                                    {
                                        <li class="py-1">
                                            <a href="@item.Url" class="text-muted">@item.MoTa</a>
                                        </li>
                                    }
                                </ol>
                            </div>
                        </div>

                    }
                    @if (BannerTrangChuVT1.Count > 0)
                    {
                        var lstAnhSilde = BannerTrangChuVT1.Where(e => e.IsSilde == 1).ToList();

                        if (lstAnhSilde != null)
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner" role="listbox">
                                        @foreach (var itemBanner in lstAnhSilde)
                                        {
                                            <div class="carousel-item @(itemBanner.ID==lstAnhSilde[0].ID?"active":"")">
                                                <a href="@itemBanner.Url"><img class="card-img-top img-fluid" src="@itemBanner.Image" alt="@itemBanner.Name" onclick="ThemLuotView(@itemBanner.ID)"></a>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                        foreach (var item in BannerTrangChuVT1.Where(e => e.IsSilde == 0).ToList())
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                                <a href="@item.Url"><img src="@item.Image" class="w-100" title="@item.Name" onclick="ThemLuotView(@item.ID)" /></a>
                            </div>
                        }
                    }


                    @if (DanhSachChuyenMucBenPhaiCT.Count > 0)
                    {
                        foreach (var item in DanhSachChuyenMucBenPhaiCT)
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                                <div class="GreenContainerTopMIddleNew pt-3">
                                    @{
                                        var Url2 = "/" + Utils.convertToUnSign2(item.Name).Replace(" ", "_") + "_cm-" + item.IdCategory + ".htm";
                                    }
                                    <h3 class="Color-left-title"><a href="@Url2" class="text-black">@item.Name</a></h3>
                                </div>
                                <div class="Content-Title">
                                    @if (item.DanhSachBaiViet.Count > 0)
                                    {
                                        <div class="card card-custom m-0">
                                            @{
                                                var Url = "/" + Utils.convertToUnSign2(item.DanhSachBaiViet[0].Title).Replace(" ", "_") + "_bv-" + item.DanhSachBaiViet[0].ID + ".htm";
                                                if (!string.IsNullOrEmpty(item.DanhSachBaiViet[0].TuKhoaSeo))
                                                {
                                                    Url = "/" + Utils.convertToUnSign2(item.DanhSachBaiViet[0].TuKhoaSeo).Replace(" ", "_") + "_bv-" + item.DanhSachBaiViet[0].ID + ".htm";
                                                }
                                            }
                                            <a href="@Url">
                                                <img class="card-img-top img-fluid img-new2" src="@item.DanhSachBaiViet[0].Thumnail" alt="Card image cap">
                                            </a>
                                            <div class="card-body p-0 pt-3">
                                                <h5 class="title-new"><a href="@Url" class="text-black">@item.DanhSachBaiViet[0].Title</a></h5>
                                                <a href="@Url">
                                                    <p class="article-excerpt">@item.DanhSachBaiViet[0].ShortDescription</p>
                                                </a>
                                            </div>
                                            @if (item.DanhSachBaiViet.Count > 1)
                                            {
                                                <ul class="list-group list-group-flush">
                                                    @foreach (var itemBV in item.DanhSachBaiViet)
                                                    {
                                                        if (itemBV.ID != item.DanhSachBaiViet[0].ID)
                                                        {
                                                            <li class="list-group-item p-0">
                                                                <div class="card border-bottom card-custom card-custom-new">
                                                                    <div class="card-body p-0 pb-3 pt-3">
                                                                        <div class="d-flex">

                                                                            <div class="flex-grow-1">
                                                                                <div>
                                                                                    @{
                                                                                        var Url1 = "/" + Utils.convertToUnSign2(itemBV.Title).Replace(" ", "_") + "_bv-" + itemBV.ID + ".htm";
                                                                                        if (!string.IsNullOrEmpty(itemBV.TuKhoaSeo))
                                                                                        {
                                                                                            Url1 = "/" + Utils.convertToUnSign2(itemBV.TuKhoaSeo).Replace(" ", "_") + "_bv-" + itemBV.ID + ".htm";
                                                                                        }
                                                                                    }
                                                                                    <h6 class="card-text font-w600 wraptext-heigth"><a href="@Url1" class="text-black">@itemBV.Title</a></h6>
                                                                                </div>
                                                                            </div>
                                                                            <div class="flex-shrink-0">
                                                                                <a href="@Url1" class="text-black">
                                                                                    <img src="@itemBV.Thumnail" alt="" class="avatar-sm-custom  rounded">
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        }
                                                    }
                                                </ul>

                                            }

                                        </div>
                                    }

                                </div>
                            </div>

                        }
                    }

                    @if (BannerTrangChuVT2.Count > 0)
                    {
                        var lstAnhSilde = BannerTrangChuVT2.Where(e => e.IsSilde == 1).ToList();

                        if (lstAnhSilde != null)
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                                <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner" role="listbox">
                                        @foreach (var itemBanner in lstAnhSilde)
                                        {
                                            <div class="carousel-item @(itemBanner.ID==lstAnhSilde[0].ID?"active":"")">
                                                <a href="@itemBanner.Url"><img class="card-img-top img-fluid" src="@itemBanner.Image" alt="@itemBanner.Name" onclick="ThemLuotView(@itemBanner.ID)"></a>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                        foreach (var item in BannerTrangChuVT2.Where(e => e.IsSilde == 0).ToList())
                        {
                            <div class="col-xl-12 col-lg-12 col-sm-12 mt-3">
                                <a href="@item.Url"><img src="@item.Image" class="w-100" title="@item.Name" onclick="ThemLuotView(@item.ID)" /></a>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script>

        function printSceen() {
            window.print();
        }

        $(document).ready(function () {
            LoadBinhLuan();
        })

        function fbs_click() {
            debugger
            u = location.href; t = document.title; window.open('http://www.facebook.com/sharer.php?u=' + encodeURIComponent(u) + '&t=' + encodeURIComponent(t), 'sharer', 'toolbar=0,status=0,width=626,height=436');
            return false;
        }

        function LikeBaiViet(Status) {
            if ($("#IdNguoiDung").val() == "" || $("#IdNguoiDung").val() == 0) {
                ToastMessage("Lỗi", "Bạn phải đăng nhập để thực hiện chức năng này", "error");
                $("#loginModals").modal("show");
                return;
            }
            var requestModel = {
                IdPost: $("#IdBaiViet").val()
            }

            if (Status == 0) {
                $.post("/ChuyenMuc/XoaLike", { "requestModel": requestModel }, function (data) {
                    if (data.type == "success") {
                        $("#TTLikeBaiViet").empty();
                        $("#TTLikeBaiViet").html(`<a href="javascript:void(0)" target="_blank" class="front-icon" onclick="LikeBaiViet(1)"><i class="bx bx-like"></i></a>`)
                    }
                    offLoading();
                });
            }
            if (Status == 1) {
                $.post("/ChuyenMuc/ThemMoiLike", { "requestModel": requestModel }, function (data) {
                    if (data.type == "success") {
                        $("#TTLikeBaiViet").empty();
                        $("#TTLikeBaiViet").html(`<a href="javascript:void(0)" target="_blank" class="front-icon" onclick="LikeBaiViet(0)"><i class=" bx bxs-like"></i></a>`)
                    }
                    offLoading();
                });
            }

        }


        function GuiBinhLuan() {
            if ($("#IdNguoiDung").val() == "" || $("#IdNguoiDung").val() == 0) {
                ToastMessage("Lỗi", "Bạn phải đăng nhập để thực hiện chức năng này", "error");
                $("#loginModals").modal("show");
                return;
            }
            if ($("#txtBinhLuan").val() == "") {
                ToastMessage("Lỗi", "Không được để trống bình luận", "error");
                return;
            }
            Swal.fire({
                title: '',
                text: "Chắc chắn thêm bình luận?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Chắc chắn',
                cancelButtonText: 'Thoát'
            }).then((result) => {
                if (result.isConfirmed) {
                    loading();

                    var requestModel = {
                        IdPost: $("#IdBaiViet").val(),
                        NoiDung: $("#txtBinhLuan").val()
                    }

                    $.post("/ChuyenMuc/ThemMoiBinhLuan", { "requestModel": requestModel }, function (data) {
                        if (data.icon == "success") {
                            Message('', data.message, data.icon);
                        }
                        else {
                            Message('', data.message, data.icon);
                        }
                        LoadBinhLuan();
                        offLoading();
                    });
                }
            })

        }


        function LoadBinhLuan() {
            $("#DataBinhLuan").load("/ChuyenMuc/_DanhSachBL", { "IdBaiViet": $("#IdBaiViet").val() }, function (data) {

            });
        }

    </script>
}