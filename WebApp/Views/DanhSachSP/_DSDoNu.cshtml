@using Models
@{
    ViewBag.Title = "_DSDoNam";
    Layout = null;
    var aothun = ViewBag.Aothun as List<Product>;
    var somi = ViewBag.AoSoMiNu as List<Product>;
    var chanvay = ViewBag.chanvay as List<Product>;
    var Sweater = ViewBag.AoSweater as List<Product>;
    var sort = ViewBag.Quansort as List<Product>;
    var quandai = ViewBag.Quandai as List<Product>;
    var UserLogin = Session["IdUser"];



}

@if (aothun.Count > 0)
{
    <div id="shop" class="shop grid-container clearfix">
        @foreach (var item in aothun)
        {
            <div class="product clearfix pf-T_shirt" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }
        @foreach (var item in somi)
        {
            <div class="product clearfix pf-shirt" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }
        @foreach (var item in chanvay)
        {
            <div class="product clearfix pf-vay" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }
        @foreach (var item in Sweater)
        {
            <div class="product clearfix pf-Sweater" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }
        @foreach (var item in sort)
        {
            <div class="product clearfix pf-Sort" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }
        @foreach (var item in quandai)
        {
            <div class="product clearfix pf-Jean" onclick="UpdateView(@item.Id)">
                <div class="product-image">
                    <input value="@UserLogin" name="IdUser" id="UserId" hidden />
                    <input value="@item.NamePro" name="NamePro" hidden />
                    <a href="#"><img src="~/FileUploaded/@item.Image" alt="Checked Short Dress"></a>
                    <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })"><img src="~/FileUploaded/@item.Image1" alt="Checked Short Dress"></a>
                    <div class="sale-flash">@item.Discount% Off*</div>
                    <div class="product-overlay">
                        <a href="javascript:void(0);" onclick="SaveGioHang(@item.Id , @item.PriceNew , '@item.NamePro' , '@item.Image')" class="add-to-cart"><i class="icon-shopping-cart"></i><span> Thêm Giỏ Hàng</span></a>
                        <a href="@Url.Action("Index","ChiTietSanPham", new { Id = item.Id })" class="item-quick-view" data-lightbox="ajax"><i class="icon-zoom-in2"></i><span> Chi Tiết</span></a>
                    </div>
                </div>
                <div class="product-desc">
                    <div class="product-title"><h3><a href="#" class="product-link">@item.NamePro</a></h3></div>
                    <div class="d-flex justify-content-sm-between">
                        <div class="product-price"><del>@item.Price.ToString("N0")đ</del> <ins>@item.PriceNew.ToString("N0")đ</ins></div>

                        <div class="product-review">
                            <div>
                                <a style="cursor: pointer; font-size: 16px;" onclick="SaveProductLike(@item.Id, @item.PriceNew, '@item.NamePro', '@item.Image'); this.classList.add('color-red')" title="Đánh dấu sản phẩm yêu thích">
                                    <i class="fa fa-heart ql-color-red"></i><span class="text-hide">Yêu thích</span>
                                </a>
                                <style>
                                    .color-red {
                                        color: red !important;
                                    }
                                </style>
                            </div>
                        </div>
                        <div class="product-review">
                            <div>
                                <i class="fa fa-eye" aria-hidden="true">@item.View</i>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        }

    </div>
}


<script>

    function UpdateView(Id) {
        $.ajax({
            url: "/Product/UpdateView",
            method: "POST",
            data: { Id: Id },
            success: function (res) {
                // Xử lý khi kết quả trả về thành công
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // Xử lý khi có lỗi xảy ra trong quá trình gửi Ajax
            }
        });
    }

    var idUser = $("#UserId").val();

    function SaveGioHang(Id, PriceNew, NamePro, Image) {
        debugger
        if ($("#UserId").val() == 0) {
            ToastMessage("Thông báo", "Vui lòng đăng nhập!", "warning");
        }
        else {
            $.ajax({
                url: "/GioHang/ThemMoi",
                type: "post",
                dataType: "json",

                data: {
                    ProductId: Id,
                    UserId: idUser,
                    Image: Image,
                    ProductName: NamePro,
                    Price: PriceNew,
                    Quantity: 1,
                    ColorId: 1,
                    SizeId: 2,

                },

                success: (data) => {
                    if (data.type == "success") {
                        ToastMessage("Thông báo", "Thêm sản phẩm thành công", "success");



                    }
                    else {
                        ToastMessage("Thông báo", "Thêm sản phẩm thành công", "success");


                    }
                }
            })


        }
    }

    function SaveProductLike(Id, PriceNew, NamePro, Image) {
        debugger
        if ($("#UserId").val() == 0) {
            alert("Vui lòng đăng nhập!");
        }
        else {

            $.ajax({
                url: "/ProductLike/ThemMoiProductLike",
                type: "post",
                dataType: "json",

                data: {
                    ProductId: Id,
                    UserId: idUser,
                    Image: Image,
                    ProductName: NamePro,
                    Price: PriceNew,
                    Quantity: 1,
                    ColorId: 1,
                    SizeId: 2,
                },

                success: (data) => {
                    if (data.type == "success") {
                        ToastMessage("Thông báo", "Thêm sản phẩm thành công", "success");



                    }
                    else {
                        ToastMessage("Lỗi", "Thêm sản phẩm thất bại", "error");

                    }
                }
            })


        }
    }
</script>
