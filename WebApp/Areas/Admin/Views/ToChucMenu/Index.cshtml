
@{

    var lstSettingMenu = ViewBag.lstSettingMenu;


}
<link href="~/Content/CMSContent/assets/libs/treegrid/dist/css/jquery.treegrid.css" rel="stylesheet" />
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">Tổ chức menu</h4>

    
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-12" id="card-none1">
        <div class="card" id="invoiceList">
            <div class="card-header border-0">
                <div class="d-flex align-items-center">
                    <h5 class="card-title mb-0 flex-grow-1">Tổ chức menu</h5>
                </div>
            </div>
            <div class="card-body bg-soft-light border border-dashed border-start-0 border-end-0">
                <div class="row g-3">

                    <div class="col-xxl-3 col-sm-12">
                        <div class="form-group">
                            <div class="form-group">
                                <select class="form-control" id="slSettingMenu" onchange="LoadAllTable()">
                                    @if (lstSettingMenu != null)
                                    {
                                        foreach (var item in lstSettingMenu)
                                        {
                                    <option value="@item.Id">@item.Ten</option>
                                        }
                                    }

                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-xl-6 col-lg-6 col-sm-12">
                        <div class="table-responsive">
                            <table class="table table-bordered align-middle table-nowrap mb-0">
                                <thead>
                                    <tr>
                                        <th scope="col" class="text-center" style="width: 70px;">STT</th>
                                        <th scope="col">Tiêu đề</th>
                                        <th scope="col" style=" text-align: center; width: 100px;">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="DataMenuChuyenMuc">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-6 col-sm-12">
                        <div class="table-responsive">
                            <table class="table table-bordered align-middle table-nowrap mb-0 tree-DataDanhMuc">
                                <thead>
                                    <tr>
                                        <th scope="col">Tiêu đề</th>
                                        <th scope="col" class="text-center">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="DanhSachChuyenMuc">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/Content/CMSContent/assets/libs/treegrid/dist/js/jquery.treegrid.min.js"></script>
    <script>

        var GridTree = null;
        $("#slSettingMenu").select2();

        $(document).ready(function () {
            LoadAllTable();
        });

        function LoadAllTable() {
            loading();
            LoadTreeTable();
            LoadSettingMenu();
        }

        function LoadTreeTable() {
            debugger;
            var requestModel = {
                IdSettingMenu: $("#slSettingMenu").val()
            }
            $("#DanhSachChuyenMuc").empty();
            $.post("/Admin/ToChucMenu/TreeTableDanhMuc", { "requestModel": requestModel }, function (data) {
                if (data.type == "success") {
                    $("#DanhSachChuyenMuc").append(data.data);
                }
                else {
                    $("#DanhSachChuyenMuc").append("");
                }
                if (GridTree == null) {
                    setTimeout(reloadtreegrid, 500);
                }
                else {
                    setTimeout(reloadtreegrid, 100);
                    setTimeout(reloadtreegrid, 200);
                }
                offLoading();
            })
        }


        function reloadtreegrid() {
            GridTree = $('.tree-DataDanhMuc').treegrid();
        }

        function LoadSettingMenu() {
            $("#DataMenuChuyenMuc").empty();

            var requestModel = {
                IdSettingMenu: $("#slSettingMenu").val()
            }

            $.post("/Admin/ToChucMenu/DanhSachChuyenMucMenu", { "requestModel": requestModel }, function (data) {
                if (data.type == "success") {
                    var StrHtml = "";
                    if (data.data.length > 0) {
                        [...data.data].map((el, index) => {
                            StrHtml += `<tr>
<td class="fw-medium"><input type="text" class="form-control" id="STT_${el.Id}" onchange="DoiSTT(${el.Id})" value="${el.STT}"></td>
<td>${el.Name}</td>
<td class="text-center"><a class="btn btn-outline-warning waves-effect waves-light btn-xs" title="Xóa" onclick="XoaMenu(${el.Id})"><i class="ri-delete-bin-line"></i></a></td>
</tr>`
                        });
                    }
                    $("#DataMenuChuyenMuc").append(StrHtml);
                }
                else {
                    $("#DataMenuChuyenMuc").empty();
                }
            })
        }


        function ThemMoiMenu(IdCategory) {
            var requestModel = {
                IdCategory: IdCategory,
                IdSettingMenu: $("#slSettingMenu").val()
            }
            $.post("/Admin/ToChucMenu/ThemMoi", { "requestModel": requestModel }, function (data) {
                if (data.type == "success") {
                    ToastMessage("Thành công", data.message, data.icon);
                } else {
                    ToastMessage("Thất bại", data.message, data.icon);
                }
                LoadSettingMenu();
                LoadTreeTable();
            })
        }
        function DoiSTT(Id) {
            var requestModel = {
                Id: Id,
                STT: $("#STT_" + Id).val()
            }
            $.post("/Admin/ToChucMenu/CapNhatSTT", { "requestModel": requestModel }, function (data) {
                if (data.type == "success") {
                    ToastMessage("Thành công", data.message, data.icon);
                } else {
                    ToastMessage("Thất bại", data.message, data.icon);
                }
                LoadSettingMenu();
            })
        }
        function XoaMenu(Id) {
            var requestModel = {
                Id: Id,
            }
            $.post("/Admin/ToChucMenu/Xoa", { "requestModel": requestModel }, function (data) {
                if (data.type == "success") {
                    ToastMessage("Thành công", data.message, data.icon);
                }
                else {
                    ToastMessage("Thất bại", data.message, data.icon);
                }
                LoadSettingMenu();
                LoadTreeTable();
            })
        }

    </script>
}