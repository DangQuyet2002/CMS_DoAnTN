
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="header_action d-flex" style="justify-content: space-between">
    <div class="float-left mr-3">
        <h3 class="site_title">
            <span>Tin Tức</span>
        </h3>
    </div>
    <div class="float-right">
        <input type="submit" value="Lọc" onclick="return false;" id="btnSearch" class="btn btn-outline-primary ml-2" data-toggle="modal" data-target="#modalSearch" style="line-height: 10px">
        <input type="submit" value="Thêm mới" id="btnThemMoi" class="btn btn-outline-success ml-2" style="line-height: 10px" data-toggle="modal" data-target="#modalThemMoi">
        <input type="submit" value="Xóa" onclick="deleteTable();" id="ContentPlaceHolder_btnDelete" class="btn btn-outline-danger ml-2" style="line-height: 10px">
    </div>
</div>
<div class="loc" style="margin: 30px 0;">
    <label>Nhập từ khóa: </label>
    <input type="text" id="txtTukhoa" />
</div>
<div class="main_content form-row d-flex ">
    <table class="table table-hover " id="tableTinTuc">
    </table>
</div>


@section scripts{

    <script>
        function ToastMessage(title, message, type) {
            toast({
                title: title,
                message: message,
                type: type,
                duration: 1000
            });
        }

        var table = null;
        $(function () {
            tableTintuc();
            $("#btnSearch").on("click", function (e) {
                e.preventDefault();
                table.ajax.reload();
            })
        })
        tableTintuc = () => {
            let config = {
                serverSide: true,
                //scrollY: "50vh",
                //scrollX: true,
                scrollCollapse: true,
                ordering: false,
                fixedHeader: true,
                ajax: {
                    url: '/TinTuc/GetAll',
                    type: 'POST',
                    data: (param) => {
                        param.Keywords = $("#txtTukhoa").val();

                    }
                },
                columns: [
                    {
                        data: "Id",
                        name: "SelectBox",
                        render: (data) => {
                            return `<div class="custom-control custom-checkbox ml-2">
                                <input type="checkbox" class="custom-control-input ckbChoDuyet" id="${data}" value="${data}">
                                <label class="custom-control-label" for="${data}"></label>
                            </div>`;
                        }
                    },
                    {
                        data: "Title",
                        name: "Title",
                        title: "Tiêu đề "
                    },
                    {
                        data: "Content",
                        name: "Content",
                        title: "Nội dung",

                    },
                    {
                        data: "Image",
                        name: "Image",
                        title: "Ảnh",

                    },

                    {
                        data: "Id", title: "Hành động", name: "action",
                        render: function (data) {
                            return `<div class="d-flex align-items-center gap-1">
                                        <button type="button" class="btn btn-sm btn-outline-warning btn-icon waves-effect waves-light" title="Sửa" onclick="btnThongTin(${data})">
                                            <svg viewBox="0 0 24 24" width="15" height="15" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                                        </button>
                                    </div>`;
                        }
                    },
                ],
                columnDefs: [
                    { width: 50, targets: [0] },
                    { width: 250, targets: [1] },
                    { width: 650, targets: [2] },
                    { width: 150, targets: [3] }
                ],
                drawCallback: () => {
                    /* dsNhomCanBoInit();*/
                },
                headerCallback: function (thead, data, start, end, display) {
                    $(thead).find('th').eq(0).html('<input type="checkbox" class="form-check-input" id="chkNhomCanBoAll" />');
                    $('#chkNhomCanBoAll').change(function () {
                        $('.ckbChoDuyet').each(function () {
                            $(this).prop('checked', $('#chkNhomCanBoAll').prop('checked'));
                            $(this).change();
                        })
                    })
                },
            }
            table = $.fn.initDataTable("#tableTinTuc", config);


        }

        $("#btnThemMoi").on("click", function (e) {
            $.fn.getData('/Admin/TinTuc/ThemMoi', {}, res => {
                debugger
                $.fn.showModal({
                    title: "THÊM MỚI",
                    bodyContent: res,
                    dialogClass: "mg"
                });
            })
        })
        function deleteTable() {
            var listId = [];
            $('.ckbChoDuyet').each(function () {
                var _checked = $(this).is(":checked")
                if (_checked) {
                    listId.push($(this).prop("value"));
                }
            })
            if (listId.length == 0) {
                ToastMessage("Lỗi", "Vui lòng chọn ít nhất một dữ liệu!!!", "warning");
                
                return;
            }
            if (confirm("Bạn chắc chắn muốn xóa những dữ liệu này?")) {
                $.fn.postData('/Admin/TinTuc/Delete', { listId: listId.join(",") }, res => {
                    ToastMessage("Thông báo", "Xóa dữ liệu thành công", "success");
                    table.ajax.reload();
                });

            }
        }
        function btnThongTin(Id) {
            $.fn.getData('/Admin/TinTuc/ChiTiet', { Id: Id }, res => {
                $.fn.showModal({
                    title: "THÔNG TIN CHI TIẾT ",
                    bodyContent: res,
                    dialogClass: "lg"
                });
            })

        }
    </script>
}